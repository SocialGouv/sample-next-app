name: Review

on:
  push:
    branches-ignore:
      - master
    tags-ignore:
      - v*

concurrency:
  cancel-in-progress: true
  group: ${{ github.ref }}

jobs:

  # deploy:
  #   name: Deploy application
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: kontinuous pipeline
  #       uses: SocialGouv/kontinuous@master
  #       with:
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #         kubeconfig: ${{ secrets.KUBECONFIG }}
  #         rancherProjectId: ${{ secrets.RANCHER_PROJECT_ID }}
  #         ciNamespace: "${{ secrets.RANCHER_PROJECT_NAME }}-ci"

  deploy:
    name: Follow deployment
    runs-on: ubuntu-latest
    steps:
      - name: kontinuous pipeline
        uses: SocialGouv/kontinuous/logs@master
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          webhookToken: ${{ secrets.KUBEWEBHOOK_TOKEN }}
          rancherProjectName: ${{ secrets.RANCHER_PROJECT_NAME }}
